# Бэкенд для сборщика анкет

Этот бэкенд-сервер написан на Node.js с использованием Express и TypeScript. Он предоставляет API для управления анкетами, обрабатывает загрузку файлов в облачное хранилище Vercel Blob и взаимодействует с Gemini API для анализа текста.

## Требования

1.  **Node.js**: v18 или выше.
2.  **Аккаунт Vercel**: С привязанным GitHub-аккаунтом.

## Локальный запуск

1.  **Установите все зависимости:** Находясь в **корневой** папке проекта, выполните:
    ```bash
    npm install
    ```
    Эта команда установит зависимости и для фронтенда, и для бэкенда.

2.  **Настройте переменные окружения для бэкенда:**
    *   В папке `backend` создайте файл с именем `.env`.
    *   Заполните его необходимыми данными: `DATABASE_URL`, `API_KEY`, `BLOB_READ_WRITE_TOKEN`.

3.  **Запустите фронтенд и бэкенд отдельно** в двух разных терминалах.
    *   Терминал 1 (из корня): `npm run dev`
    *   Терминал 2 (из папки `backend`): `npm run dev`


## Развертывание (Deployment) на Vercel

Vercel — идеальный выбор для этого проекта, так как он позволяет разместить фронтенд, бэкенд и базу данных в одном месте.

### Шаг 1: Подготовка

1.  Убедитесь, что ваш код, включая файл `vercel.json`, загружен на GitHub.
2.  Создайте файл `.gitignore` в корне проекта, чтобы не загружать `node_modules` и `.env` файлы.

### Шаг 2: Создание проекта на Vercel

1.  Зарегистрируйтесь на [Vercel.com](https://vercel.com/) с помощью вашего аккаунта GitHub.
2.  На панели управления нажмите **"Add New..." -> "Project"**.
3.  Найдите и выберите ваш репозиторий и нажмите **"Import"**.

### Шаг 3: Настройка проекта

Vercel автоматически определит, что у вас Vite-проект (фронтенд) и настроит его сборку. Вам нужно лишь указать переменные окружения для бэкенда.

1.  Раскройте секцию **"Environment Variables"**.
2.  Добавьте следующие переменные:
    *   `API_KEY`: Ваш ключ от Google Gemini API.
    *   `NODE_ENV`: `production`

3.  **Важно:** Переменные для базы данных (`POSTGRES_URL` и т.д.) и хранилища файлов (`BLOB_READ_WRITE_TOKEN`) нужно добавить через интерфейс Vercel.

4.  Нажмите кнопку **"Deploy"**. Vercel начнет сборку. **Первое развертывание может завершиться ошибкой**, так как база данных и хранилище еще не подключены. Это нормально.

### Шаг 4: Подключение Базы Данных и Хранилища

1.  После завершения первого развертывания, перейдите в настройки вашего нового проекта на Vercel.
2.  Откройте вкладку **"Storage"**.
3.  Сначала создайте базу данных, выбрав **Neon (Serverless Postgres)** из списка провайдеров в Marketplace. Следуйте инструкциям. Vercel автоматически создаст и привяжет все необходимые переменные к вашему проекту.
4.  Затем создайте хранилище для файлов: рядом с **"Blob"** нажмите **"Connect Store"**. Создайте новое хранилище. Vercel автоматически добавит переменную `BLOB_READ_WRITE_TOKEN`.

### Шаг 5: Финальное развертывание

1.  После подключения базы данных и хранилища, перейдите на вкладку **"Deployments"**.
2.  Найдите самое последнее (скорее всего, проваленное) развертывание.
3.  В меню (три точки) выберите **"Redeploy"**.

Теперь Vercel пересоберет проект с уже подключенными сервисами. После успешной сборки ваше приложение будет полностью работать онлайн.