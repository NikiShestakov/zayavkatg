# Бэкенд для сборщика анкет

Этот бэкенд-сервер написан на Node.js с использованием Express и TypeScript. Он предоставляет API для управления анкетами, обрабатывает загрузку файлов и взаимодействует с Gemini API для анализа текста.

## Требования

1.  **Node.js**: v18 или выше.
2.  **PostgreSQL**: Установленная и запущенная база данных.

## Шаг 1: Установка

1.  Перейдите в директорию `backend`:
    ```bash
    cd backend
    ```

2.  Установите все необходимые зависимости:
    ```bash
    npm install
    ```

## Шаг 2: Настройка базы данных PostgreSQL

1.  Подключитесь к вашему серверу PostgreSQL. Вам может понадобиться `psql` или графический клиент типа DBeaver/PgAdmin.

2.  Создайте нового пользователя и базу данных для приложения. **ВАЖНО:** Замените `my_user` и `mysecretpassword` на свои значения.

    ```sql
    CREATE USER my_user WITH PASSWORD 'mysecretpassword';
    CREATE DATABASE profiles_db OWNER my_user;
    ```

## Шаг 3: Настройка переменных окружения

1.  В папке `backend` создайте файл с именем `.env`.

2.  Скопируйте содержимое из `.env.example` в ваш новый файл `.env`.

3.  Отредактируйте `.env`, указав ваши реальные данные:
    *   `DATABASE_URL`: Строка подключения к вашей базе данных. Используйте пользователя и базу данных, созданные на Шаге 2. Пример: `postgresql://my_user:mysecretpassword@localhost:5432/profiles_db`.
    *   `API_KEY`: Ваш ключ от Google Gemini API.
    *   `PORT`: Порт, на котором будет работать бэкенд. По умолчанию `3001`.

## Шаг 4: Запуск бэкенда

1.  Для **разработки** (с автоматической перезагрузкой при изменениях):
    ```bash
    npm run dev
    ```
    При первом запуске сервер автоматически создаст необходимые таблицы (`profiles`, `media_items`) в вашей базе данных.

2.  Для **продакшена**:
    Сначала соберите проект:
    ```bash
    npm run build
    ```
    Затем запустите скомпилированный код:
    ```bash
    npm run start
    ```

Сервер будет запущен по адресу `http://localhost:3001`.

## Шаг 5: Развертывание (Deployment)

Для развертывания на платформах вроде Render, Heroku или DigitalOcean, вам понадобятся следующие настройки:

*   **Корневая директория (Root Directory)**: `backend`
*   **Команда сборки (Build Command)**: `npm install && npm run build`
*   **Команда запуска (Start Command)**: `npm run start`
*   **Переменные окружения (Environment Variables)**:
    *   `DATABASE_URL`: Строка подключения к вашей продакшн-базе данных (обычно предоставляется хостинг-провайдером).
    *   `API_KEY`: Ваш ключ от Google Gemini API.
    *   `NODE_ENV`: `production`

## Как запустить весь проект (Frontend + Backend)

1.  Откройте два терминала.
2.  В **первом терминале** запустите бэкенд:
    ```bash
    cd backend
    npm run dev
    ```
3.  Во **втором терминале** запустите фронтенд (из корневой папки проекта):
    ```bash
    # Убедитесь, что у вас есть файл .env в корне с VITE_API_BASE_URL
    npm run dev
    ```
4.  Откройте в браузере адрес, который покажет Vite (обычно `http://localhost:5173`).

Теперь ваш фронтенд будет автоматически отправлять API-запросы на ваш работающий бэкенд.
